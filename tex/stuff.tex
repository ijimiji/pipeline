\section{Основные инструменты построения распределенных архитектур}

Одним из ключевых вопросов при построении распределенных архитектур является асинхронная коммуникация
между миросервисами, которая позволяет независимо масштабировать ее компоненты.

Брокер сообщений служит критически важным компонентом при проектировании архитектуры микросервисов, работая как посредник при передаче данных между различными сервисами, 
он позволяет минимизировать прямые связи и обеспечивает ряд ключевых преимуществ, которые облегчают разработку, масштабирование и поддержку сложных микросервисных систем.
Одно из основных преимуществ использования брокера сообщений -- возможность полного разделения различных компонентов системы. 
В архитектуре микросервисов подобное разделение является важным фактором в обеспечении независимости каждого из сервисов. 
Благодаря брокеру сообщений, компоненты в системе не должны прямо общаться друг с другом, что повышает их изоляцию и позволяет им работать независимо. 
Это упрощает процесс обновления или модификации отдельных компонентов, поскольку минимизирует риск сбоев всей системы из-за изменений в одном из сервисов.

Далее, использование брокера сообщений увеличивает надежность системы. Благодаря использованию промежуточного слоя для передачи сообщений, они могут быть надежно сохранены и переданы даже при временных сбоях приема или трансляции. 
Это гарантирует, что важные данные не будут потеряны из-за сбоев или проблем с конкретными сервисами, усиливая отказоустойчивость всей системы.

Помимо этого, брокеры сообщений обеспечивают асинхронную передачу данных. 
Это означает, что система не требует немедленного ответа от сервиса-получателя, что может быть критически важно при высоких нагрузках. 
Брокеры сообщений могут агрегировать сообщения и управлять их доставкой оптимальным образом, обеспечивая более плавную и эффективную работу системы.

На рынке представлено множество различных брокеров сообщений, включая RabbitMQ, Apache Kafka, Google Pub/Sub и AWS Simple Queue Service (SQS). 
Каждый из этих продуктов предлагает различные функции и возможности, такие как надежные очереди сообщений, модели публикации/подписки, устойчивость к ошибкам и многое другое. 
Это позволяет разработчикам выбирать наиболее подходящий брокер сообщений для их конкретных нужд и требований.

В итоге, брокеры сообщений играют ключевую роль в архитектуре микросервисов. Они повышают надежность и устойчивость системы, обеспечивают разделение между сервисами и позволяют более эффективно управлять данными и нагрузкой в рамках сложных микросервисных экосистем.

В данной работе основной акцент делается на Amazon Simple Queue Service (SQS), поскольку он является мощным инструментом для обработки сообщений в архитектуре микросервисов и обладает несколькими ключевыми преимуществами, 
которые делают его привлекательным выбором для различных сценариев использования.

Amazon SQS предлагает высокую надежность благодаря инфраструктуре Amazon. 
Сервис гарантирует доставку сообщения хотя бы один раз, что помогает избежать потери данных. Кроме того, Amazon SQS предлагает очереди с повышенной отказоустойчивостью, которые хранят сообщения на протяжении определенного времени, пока они не будут успешно обработаны получателем.

Amazon SQS легко масштабируется, чтобы обеспечивать эффективную обработку больших объемов данных. 
Благодаря возможности бесконечного расширения, этот сервис может гибко настраиваться для поддержки микросервисов любого размера, чтобы поддерживать высокую производительность без дополнительных усилий с вашей стороны.
Также благодаря тесной интеграции с AWS Identity and Access Management (IAM), Amazon SQS позволяет точно контролировать доступ к очередям сообщений, обеспечивая высокий уровень безопасности. Также доступны функции транзитного шифрования для дополнительной защиты данных.

Вместе с облачной инфраструктурой предоставляются SDK для разных языков, включая AWS Management Console, SDK и CLI. Что позволяет использовать одинаковые семантики и метод API вне зависимости от языка и освобождает от необходимости писать свои клиенты для
взаимодействия с очередью.
Также если вы уже используете другие сервисы от AWS, такие как Lambda, S3 или EC2, использование SQS значительно упрощает интеграцию микросервисов, поскольку все они работают вместе без каких-либо существенных проблем. Использование
S3, например, в качестве промежуточного медиума может позволить передавать сообщения большого размера вне зависимости от отграничений SQS, что представлено в Java SDK для работы с SQS.

Таким образом, Amazon SQS представляет собой отличный выбор для обработки сообщений в архитектуре микросервисов благодаря своей надежности, масштабируемости, безопасности и простоте использования. Благодаря настройке под конкретные потребности и легкой интеграции с другими сервисами AWS, SQS может стать очень ценным активом в микросервисной архитектуре.

При локальной разработке необязательно прибегать к выделению облачных инстансов SQS, а можно воспользоваться сторонними реализациями, которые доступны для развертывания вне облачной инфраструктуры AWS. Примерами подобных решений являются Localstack, Minio, а также официальные образы Amazon
некоторых сервисов, доступных в облаке.

В контексте реализации асинхронного взаимодействия между микросервисами применяются следующий набор методов SDK для языка Go:
\begin{enumerate}
    \item SendMessageWithContext, который отправляет закодированное сообщение в произвольном формате в очередь с адресом QueueUrl и позволяет отменять вызов низлежащего сетевого запроса по переданному Context.
    \item ReceiveMessageWithContext, который получает MaxNumberOfMessages сообщений из очереди с адресом QueueUrl и так же предоставляет синхронизацию через Context.
    Чтение данным методом автоматически проставляет период видимости сообщений, при котором сообщения не будут прочитаны другими 
    потребителями повторно.
    \item DeleteMessageWithContext, который окончательно удаляет сообщение из очереди QueueUrl с индентификатором, 
    полученным в методе DeleteMessageWithContext, а также предоставляет синхронизацию через Context.
     Данный метод реализует подтверждение обработки сообщения и в других 
    брокерах может называться Acknowledge (ACK).
\end{enumerate}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.95\textwidth]{img/sqs.png}
  \caption{SQS}
    \label{fig:sqs}
\end{figure}
